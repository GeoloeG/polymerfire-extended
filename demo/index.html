<!doctype html>
<html>
  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <title>firebase-element-extended Demo</title>

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>

    <link rel="import" href="../../polymer/polymer.html">

    <link rel="import" href="../../firebase-element/firebase-auth.html">
    <link rel="import" href="../../paper-button/paper-button.html">
    <link rel="import" href="../../paper-styles/color.html">
    <link rel="import" href="../../paper-styles/demo-pages.html">
    <link rel="import" href="../../neon-animation/animations/scale-up-animation.html">
    <link rel="import" href="../../neon-animation/animations/fade-out-animation.html">
    <link rel="stylesheet" href="../../paper-styles/demo.css">

    <link rel="import" href="../firebase-auth-dialog.html">

    <style is="custom-style">
      /*TODO PG: beautify the dialog... :)*/

      section > paper-button {
        background-color: var(--google-grey-300);
        padding: 5px;
      }

      section > paper-button:hover {
        background-color: var(--paper-light-blue-200);
        padding: 5px;
      }

      /*TODO PG: check the style...*/
      firebase-auth-dialog.colored {
        border: 2px solid;
        border-color: var(--paper-green-500);
        background-color: var(--paper-light-green-50);
        color: var(--paper-green-500);
      }

      firebase-auth-dialog.size-position {
        position: fixed;
        top: 16px;
        right: 16px;
        width: 300px;
        height: 300px;
        overflow: auto;
      }
    </style>

  </head>
  <body unresolved>
    <template id="t" is="dom-bind">

      <paper-button on-tap="signUpButton" disabled="[[user]]">Register Dialog</paper-button>
      <paper-button on-tap="signInButton" disabled="[[user]]">Login Dialog</paper-button>
      <paper-button on-tap="signOutButton" disabled="[[!user]]">Logout</paper-button>

      <!-- TODO PG: Add a selection check box to add the services used -->
      <firebase-auth id="firebaseAuth"
        user="{{user}}"
        status-known="{{statusKnown}}"
        location="https://metanov-test.firebaseio.com"
        on-error="errorHandler"
        >
      </firebase-auth>

      <firebase-auth-dialog id="firebaseAuthDialog"
        entry-animation="scale-up-animation"
        exit-animation="fade-out-animation"
        providers='["facebook", "github", "google"]'
        modal with-backdrop>
        <span introduction>-- Welcome to the FBE Demo: --</span>
        <span provider>-- Register/Login with one of the following provider(s): --</span>
        <span user>-- or provide your email and password : --</span>
      </firebase-auth-dialog>

      <h3>Register status:</h3>
      <!-- TODO PG: add user registered temp message -->
      <p id="register"></p>

      <h3>Login status:</h3>
      <pre id="login">[[_showStatus(statusKnown,user)]]</pre>

      <h3>User</h3>
      <pre id="user">[[_showUser(user)]]</pre>

      <h3>Error status:</h3>
      <pre id="error-msg"></pre>

    </template>

    <script>
      var t = document.getElementById('t');

      t._showUser = function(user) {
        return JSON.stringify(user);
      };

      t._showStatus = function(statusKnown, user) {
        if (statusKnown && user) {
          return 'Logged in';
        }
        if (statusKnown) {
          return 'Logged out';
        }
        return 'Unknown (checking status...)';
      };

      t.signUpButton = function() {
        var error = document.getElementById("error-msg");
        error.innerText = "";
        var firebaseAuthDialog = document.getElementById("firebaseAuthDialog");
        firebaseAuthDialog.setAttribute('type', "Register");
        firebaseAuthDialog.open();
      };

      t.signInButton = function() {
        var error = document.getElementById("error-msg");
        error.innerText = "";
        var register = document.getElementById("register");
        register.innerText = "";
        var firebaseAuthDialog = document.getElementById("firebaseAuthDialog");
        firebaseAuthDialog.setAttribute('type', "Login");
        firebaseAuthDialog.open();
      };

      t.signOutButton = function() {
        var error = document.getElementById("error-msg");
        error.innerText = "";
        var register = document.getElementById("register");
        register.innerText = "";
        var firebaseAuth = document.getElementById("firebaseAuth");
        firebaseAuth.logout();
      };

      t.errorHandler = function(e) {
        var error = document.getElementById("error-msg");
        error.innerText = JSON.stringify(e.detail);
      }

      window.addEventListener('sign-up', signUpHandler);
      window.addEventListener('sign-in', signInHandler);

      function signUpHandler(e) {
        var firebaseAuth = document.getElementById("firebaseAuth");
        var params = e.detail.params;
        firebaseAuth.createUser(params.email, params.password);

        var register = document.getElementById("register");
        register.innerText = "Registered";
        // FIXME PG: not additional user ID provided in the event...
        // https://github.com/GoogleWebComponents/firebase-element/issues/74

        // var user = document.getElementById("user");
        // user.innerHTML = JSON.stringify(e.detail);
      }

      function signInHandler(e) {
        var firebaseAuth = document.getElementById("firebaseAuth");
        firebaseAuth.provider = e.detail.provider;
        firebaseAuth.login(e.detail.params);
      }

    </script>

  </body>
</html>
