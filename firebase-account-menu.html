<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-menu-button/paper-menu-button.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../neon-animation/animations/fade-out-animation.html">

<link rel="import" href="./firebase-auth-dialog.html">
<link rel="import" href="./firebase-icons.html">
<link rel="import" href="./firebase-identicon.html">
<link rel="import" href="./firebase-state.html">

<!--
`<firebase-account-menu>` is a navigation menu to be placed inside a `<paper-toolbar>` that provides and hook the sign-XXX functionnality of `<firebase-auth-manager>`.
It also provides access to the menu dedicated to account action.

Example:

    <firebase-account-menu>
      TODO PG: add paper-item item
    </firebase-account-menu>

@group GoogleWebComponents Elements
@element firebase-account-menu
@demo demo/index.html
@hero hero.svg
-->
<dom-module id="firebase-account-menu">
  <template>
    <style>
      /*TODO PG: beautify... :)*/
      :host {
        display: block;
      }

      #signedIn, #signedOut {
        display: flex;
        align-items: center;
      }

      iron-image {
        width: 45px;
        height: 45px;
        border-radius: 10px;
      }

      #profileLabel {
        padding-left: 8px;
      }

      paper-button:hover {
        opacity: 0.7;
      }
    </style>

    <firebase-state logged="{{logged}}" profile="{{profile}}"></firebase-state>

    <paper-menu-button hidden$="[[!logged]]"
                       vertical-offset="72"
                       horizontal-align="right"
                       horizontal-offset="12">
      <paper-button id="signedIn" class="dropdown-trigger">
        <iron-image src="[[profile.picture]]" sizing="cover"></iron-image>
        <span id="profileLabel">[[profile.displayName]]</span>
        <iron-icon icon="expand-more"></iron-icon>
      </paper-button>
      <paper-menu class="dropdown-content">
        <!-- TODO PG: here comes the user specific menu... -->
        <content></content>
        <paper-item>Profile</paper-item>
        <paper-item on-tap="signOutButton">Sign Out</paper-item>
      </paper-menu>
    </paper-menu-button>
    <div id="signedOut" hidden$="[[logged]]">
      <paper-button on-tap="signUpButton">Register</paper-button>
      <paper-button on-tap="signInButton">Login</paper-button>
    </div>
  </template>
  <script>

    Polymer({
      is: 'firebase-account-menu',

      get _firebaseAuthDialog() {
        return this._firebaseMeta && this._firebaseMeta.byKey("firebaseAuthDialog");
      },

      ready: function() {
        this._firebaseMeta = new Polymer.IronMeta({type: "firebaseExtended"});
      },

      signUpButton: function() {
        if (this._firebaseAuthDialog) {
          this._firebaseAuthDialog.setAttribute('type', "Register");
          this._firebaseAuthDialog.open();
        } else {
          console.warn("Missing registered firebaseAuthDialog");
        }
      },

      signInButton: function() {
        if (this._firebaseAuthDialog) {
          this._firebaseAuthDialog.setAttribute('type', "Login");
          this._firebaseAuthDialog.open();
        } else {
          console.warn("Missing registered firebaseAuthDialog");
        }
      },

      signOutButton: function() {
        this.fire('sign-out');
      }

      /**
        Fired when a user sign-out.

        @event sign-out
      */
    });

  </script>
</dom-module>

